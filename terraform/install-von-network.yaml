- name: install-von-network
  hosts: all
  vars:
    docker_users:
      - zorro
    docker_install_compose_plugin: true
    docker_packages_state: present

  roles:
    - role: geerlingguy.docker
      become: true

  tasks:
    - name: Checkout Von git repository
      ansible.builtin.git:
        repo: https://github.com/bcgov/von-network.git
        dest: /home/zorro/von-network
        version: main

    - name: Reset ssh connection fix for docker permsission error
      ansible.builtin.meta: reset_connection

    - name: Build VON-Network
      ansible.builtin.command: "/bin/bash manage build"
      args:
        chdir: "/home/zorro/von-network"
      register: result
      changed_when: result.rc != 0

    - name: Print return information from the previous task
      ansible.builtin.debug:
        var: result

    - name: Run VON-Network
      ansible.builtin.command: "/bin/bash manage start"
      args:
        chdir: "/home/zorro/von-network"
      register: result
      changed_when: result.rc != 0

    - name: Print return information from the previous task
      ansible.builtin.debug:
        var: result
